---
name: Publish

# yamllint disable-line rule:truthy
on:
  push:
    branches: [main, master]
  workflow_dispatch:
  schedule:
    - cron: "30 4 * * *"

permissions: read-all

concurrency:
  group: ${{ github.ref }}-${{ github.workflow }}
  cancel-in-progress: true

jobs:
  docker:
    runs-on: ubuntu-22.04
    permissions: write-all
    steps:
      - name: Checkout
        uses: actions/checkout@f43a0e5ff2bd294095638e18286ca9a3d1956744 # pin@v3

     - name: Build and Publish Image
        uses: wesley-dean/publish_container@v0.2.0
        with:
          dockerhub_username: ${{ secrets.DOCKERHUB_USERNAME }}
          dockerhub_token: ${{ secrets.DOCKERHUB_PAT }}
          ghcr_username: ${{ secrets.GITHUB_USERNAME }}
          ghcr_token: ${{ secrets.GITHUB_PAT }}
          github_ref: ${{ github.ref }}
          repository_name: ${{ github.event.repository.name }}

